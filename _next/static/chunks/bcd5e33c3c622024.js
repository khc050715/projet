(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},18566,(e,t,a)=>{t.exports=e.r(76562)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},95430,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);e.i(36180);var r=e.i(98925),l=e.i(59141),i=e.i(71689),n=e.i(56909),o=e.i(31278),c=e.i(75254);let d=(0,c.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,c.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),x=(0,c.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var u=e.i(22016);let p=(0,e.i(70703).default)(()=>e.A(88174),{loadableGenerated:{modules:[72113]},ssr:!1});function m(){let e=(0,s.useRouter)(),c=(0,s.useSearchParams)().get("id"),[m,f]=(0,a.useState)(null),y=(0,a.useRef)(null),[g,v]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[w,N]=(0,a.useState)(null),[k,M]=(0,a.useState)([]),[_,S]=(0,a.useState)(!1),[C,L]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=l.auth.onAuthStateChanged(async t=>{if(!t||!c)return e.push("/");f(t);let a=(0,r.doc)(l.db,"records",c),s=await (0,r.getDoc)(a);if(s.exists()){let e=s.data();v(e.title),j(e.content),N(e),y.current?.setMarkdown(e.content),M((await (0,r.getDocs)((0,r.query)((0,r.collection)(a,"revisions"),(0,r.orderBy)("archived_at","desc")))).docs.map(e=>({id:e.id,...e.data()})))}});return()=>t()},[c,e]);let D=async()=>{g&&b&&(S(!0),w&&await (0,r.addDoc)((0,r.collection)((0,r.doc)(l.db,"records",c),"revisions"),{snapshot_title:w.title,snapshot_content:w.content,archived_at:(0,r.serverTimestamp)(),archived_by:m.uid}),await (0,r.updateDoc)((0,r.doc)(l.db,"records",c),{title:g,content:b,updated_at:(0,r.serverTimestamp)(),last_modified_by:m.uid}),e.push(`/view?id=${c}`))},T=async()=>{if(confirm("정말로 이 기록을 영구 삭제하시겠습니까? (복구 불가)")){L(!0);try{await (0,r.deleteDoc)((0,r.doc)(l.db,"records",c)),e.push("/")}catch(e){console.error(e),L(!1)}}};return w?(0,t.jsxs)("main",{className:"projet-container",children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center",children:[(0,t.jsxs)(u.default,{href:`/view?id=${c}`,className:"text-gray-500 hover:text-white flex items-center gap-2 text-sm font-medium transition-colors",children:[(0,t.jsx)(i.ArrowLeft,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("button",{onClick:T,disabled:_||C,className:"bg-red-900/10 text-red-500 border border-red-900/30 px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-900/30 disabled:opacity-50 flex items-center gap-2 transition-all",children:[C?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(x,{className:"w-4 h-4"}),"Delete"]}),(0,t.jsxs)("button",{onClick:D,disabled:_||C,className:"bg-yellow-600 text-white px-5 py-2 rounded-lg text-sm font-bold hover:bg-yellow-700 disabled:opacity-50 flex items-center gap-2 shadow-lg shadow-yellow-900/20",children:[_?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(n.Save,{className:"w-4 h-4"}),"Update"]})]})]}),(0,t.jsxs)("section",{className:"flex flex-col gap-6 mt-4",children:[(0,t.jsx)("input",{type:"text",className:"w-full bg-transparent text-3xl font-bold text-white placeholder-gray-700 border-none outline-none p-0",value:g,onChange:e=>v(e.target.value)}),(0,t.jsx)("div",{className:"min-h-[400px] border border-gray-800 rounded-xl p-1 bg-[#0a0a0a]",children:(0,t.jsx)(p,{ref:y,markdown:b,onChange:j})})]}),(0,t.jsxs)("section",{className:"border-t border-gray-800 pt-8 flex flex-col gap-4",children:[(0,t.jsxs)("h2",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:[(0,t.jsx)(d,{className:"w-4 h-4"})," Revision History"]}),0===k.length?(0,t.jsx)("p",{className:"text-gray-700 text-sm italic",children:"No revisions yet."}):(0,t.jsx)("div",{className:"flex flex-col gap-3",children:k.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-4 rounded-lg bg-[#111] border border-gray-800 hover:border-gray-600 transition-all group",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 overflow-hidden",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:e.archived_at?.toDate().toLocaleString()}),(0,t.jsx)("span",{className:"text-sm text-gray-300 truncate font-medium",children:e.snapshot_title})]}),(0,t.jsxs)("button",{onClick:()=>{confirm("이 버전으로 내용을 되돌리시겠습니까?")&&(v(e.snapshot_title),j(e.snapshot_content),y.current?.setMarkdown(e.snapshot_content),window.scrollTo(0,0))},className:"opacity-0 group-hover:opacity-100 text-xs bg-gray-800 text-yellow-500 px-3 py-1.5 rounded-md hover:bg-yellow-900/30 transition-all flex items-center gap-1",children:[(0,t.jsx)(h,{className:"w-3 h-3"})," Restore"]})]},e.id))})]})]}):(0,t.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,t.jsx)(o.Loader2,{className:"animate-spin text-gray-600"})})}function f(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"h-screen flex items-center justify-center bg-black",children:(0,t.jsx)(o.Loader2,{className:"animate-spin text-gray-600"})}),children:(0,t.jsx)(m,{})})}e.s(["default",()=>f],95430)},88174,e=>{e.v(t=>Promise.all(["static/chunks/249f79e06c87ce1d.js","static/chunks/c0a0c0f35d0a8771.css"].map(t=>e.l(t))).then(()=>t(72113)))}]);