(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},30911,37727,e=>{"use strict";var t=e.i(71645);e.i(51718);var a=e.i(18357),s=e.i(59141),n=e.i(18566);function i(e=!1){let[l,r]=(0,t.useState)(null),[c,o]=(0,t.useState)(!0),d=(0,n.useRouter)();return(0,t.useEffect)(()=>{let t=(0,a.onAuthStateChanged)(s.auth,t=>{r(t),o(!1),e&&!t&&d.push("/")});return()=>t()},[e,d]),{user:l,loading:c}}e.s(["formatDate",0,e=>e?new Date(e.toDate()).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric",weekday:"short"}):"","useAuth",()=>i],30911);let l=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>l],37727)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},95430,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);e.i(36180);var n=e.i(98925),i=e.i(59141),l=e.i(30911),r=e.i(71689),c=e.i(56909),o=e.i(31278),d=e.i(75254);let u=(0,d.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,d.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var x=e.i(37727),m=e.i(22016);let p=(0,e.i(70703).default)(()=>e.A(88174),{loadableGenerated:{modules:[72113]},ssr:!1});function f(){let e=(0,s.useRouter)(),d=(0,s.useSearchParams)().get("id"),{user:f}=(0,l.useAuth)(!0),v=(0,a.useRef)(null),[b,g]=(0,a.useState)(""),[y,j]=(0,a.useState)(""),[w,k]=(0,a.useState)([]),[N,z]=(0,a.useState)(""),[S,_]=(0,a.useState)(null),[M,D]=(0,a.useState)([]),[C,A]=(0,a.useState)(!1);(0,a.useEffect)(()=>{f&&d&&(async()=>{let e=(0,n.doc)(i.db,"records",d),t=await (0,n.getDoc)(e);if(t.exists()){let a=t.data();g(a.title),j(a.content),k(a.tags||[]),_(a),v.current?.setMarkdown(a.content),D((await (0,n.getDocs)((0,n.query)((0,n.collection)(e,"revisions"),(0,n.orderBy)("archived_at","desc")))).docs.map(e=>({id:e.id,...e.data()})))}})()},[f,d]);let R=async()=>{b&&y&&(A(!0),S&&await (0,n.addDoc)((0,n.collection)((0,n.doc)(i.db,"records",d),"revisions"),{snapshot_title:S.title,snapshot_content:S.content,snapshot_tags:S.tags,archived_at:(0,n.serverTimestamp)(),archived_by:f.uid}),await (0,n.updateDoc)((0,n.doc)(i.db,"records",d),{title:b,content:y,tags:w,updated_at:(0,n.serverTimestamp)(),last_modified_by:f.uid}),e.push(`/view?id=${d}`))};return S?(0,t.jsxs)("main",{className:"projet-container",children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center",children:[(0,t.jsxs)(m.default,{href:`/view?id=${d}`,className:"text-zinc-500 hover:text-white flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(r.ArrowLeft,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("button",{onClick:R,disabled:C,className:"bg-amber-600 text-white px-5 py-2 rounded-lg text-sm font-bold hover:bg-amber-700 disabled:opacity-50 flex items-center gap-2 shadow-lg shadow-amber-900/20",children:[C?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(c.Save,{className:"w-4 h-4"})," Update"]})]}),(0,t.jsxs)("section",{className:"flex flex-col gap-6 mt-4",children:[(0,t.jsx)("input",{type:"text",className:"w-full bg-transparent text-3xl font-bold text-white placeholder-zinc-700 border-none outline-none p-0",value:b,onChange:e=>g(e.target.value)}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[w.map(e=>(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full bg-zinc-800 text-zinc-300 text-sm font-medium",children:[e," ",(0,t.jsx)("button",{onClick:()=>k(w.filter(t=>t!==e)),className:"hover:text-white",children:(0,t.jsx)(x.X,{className:"w-3 h-3"})})]},e)),(0,t.jsx)("input",{type:"text",placeholder:"Add notes...",className:"bg-transparent text-zinc-400 placeholder-zinc-700 outline-none min-w-24",value:N,onChange:e=>z(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=N.trim();t&&!w.includes(t)&&k([...w,t]),z("")}else"Backspace"===e.key&&!N&&w.length>0&&k(w.slice(0,-1))}})]}),(0,t.jsx)("div",{className:"min-h-100 border border-zinc-800 rounded-xl p-1 bg-[#0a0a0a]",children:(0,t.jsx)(p,{ref:v,markdown:y,onChange:j})})]}),(0,t.jsxs)("section",{className:"border-t border-zinc-800 pt-8 flex flex-col gap-4",children:[(0,t.jsxs)("h2",{className:"text-xs font-bold text-zinc-500 uppercase tracking-widest flex items-center gap-2",children:[(0,t.jsx)(u,{className:"w-4 h-4"})," Revision History"]}),(0,t.jsx)("div",{className:"flex flex-col gap-3",children:M.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-4 rounded-lg bg-[#111] border border-zinc-800 hover:border-zinc-700 transition-all group",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 overflow-hidden",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-500 font-mono",children:e.archived_at?.toDate().toLocaleString()}),(0,t.jsx)("span",{className:"text-sm text-zinc-300 truncate font-medium",children:e.snapshot_title})]}),(0,t.jsxs)("button",{onClick:()=>{confirm("Restore this version?")&&(g(e.snapshot_title),j(e.snapshot_content),k(e.snapshot_tags||[]),v.current?.setMarkdown(e.snapshot_content),window.scrollTo(0,0))},className:"opacity-0 group-hover:opacity-100 text-xs bg-zinc-800 text-amber-500 px-3 py-1.5 rounded-md hover:bg-zinc-700 transition-all flex items-center gap-1",children:[(0,t.jsx)(h,{className:"w-3 h-3"})," Restore"]})]},e.id))})]})]}):(0,t.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,t.jsx)(o.Loader2,{className:"animate-spin text-zinc-500"})})}function v(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{}),children:(0,t.jsx)(f,{})})}e.s(["default",()=>v],95430)},88174,e=>{e.v(t=>Promise.all(["static/chunks/42deda8852a73de0.js","static/chunks/c0a0c0f35d0a8771.css"].map(t=>e.l(t))).then(()=>t(72113)))}]);