(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},18566,(e,t,a)=>{t.exports=e.r(76562)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},95430,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);e.i(36180);var l=e.i(98925),r=e.i(59141),i=e.i(71689),n=e.i(56909),o=e.i(31278),c=e.i(75254);let d=(0,c.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,c.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var x=e.i(22016);let u=(0,e.i(70703).default)(()=>e.A(88174),{loadableGenerated:{modules:[72113]},ssr:!1});function p(){let e=(0,s.useRouter)(),c=(0,s.useSearchParams)().get("id"),[p,m]=(0,a.useState)(null),[f,y]=(0,a.useState)(""),[g,v]=(0,a.useState)(""),[b,j]=(0,a.useState)(null),[w,N]=(0,a.useState)([]),[k,_]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=r.auth.onAuthStateChanged(async t=>{if(!t||!c)return e.push("/");m(t);let a=(0,l.doc)(r.db,"records",c),s=await (0,l.getDoc)(a);if(s.exists()){let e=s.data();y(e.title),v(e.content),j(e),N((await (0,l.getDocs)((0,l.query)((0,l.collection)(a,"revisions"),(0,l.orderBy)("archived_at","desc")))).docs.map(e=>({id:e.id,...e.data()})))}});return()=>t()},[c,e]);let S=async()=>{f&&g&&(_(!0),b&&await (0,l.addDoc)((0,l.collection)((0,l.doc)(r.db,"records",c),"revisions"),{snapshot_title:b.title,snapshot_content:b.content,archived_at:(0,l.serverTimestamp)(),archived_by:p.uid}),await (0,l.updateDoc)((0,l.doc)(r.db,"records",c),{title:f,content:g,updated_at:(0,l.serverTimestamp)(),last_modified_by:p.uid}),e.push(`/view?id=${c}`))};return b?(0,t.jsxs)("main",{className:"projet-container",children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center",children:[(0,t.jsxs)(x.default,{href:`/view?id=${c}`,className:"text-gray-500 hover:text-white flex items-center gap-2 text-sm font-medium",children:[(0,t.jsx)(i.ArrowLeft,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("button",{onClick:S,disabled:k,className:"bg-yellow-600 text-white px-5 py-2 rounded-lg text-sm font-bold hover:bg-yellow-700 disabled:opacity-50 flex items-center gap-2 shadow-lg shadow-yellow-900/20",children:[k?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(n.Save,{className:"w-4 h-4"})," Update"]})]}),(0,t.jsxs)("section",{className:"flex flex-col gap-6 mt-4",children:[(0,t.jsx)("input",{type:"text",className:"w-full bg-transparent text-3xl font-bold text-white placeholder-gray-700 border-none outline-none p-0",value:f,onChange:e=>y(e.target.value)}),(0,t.jsx)("div",{className:"min-h-[400px] border border-gray-800 rounded-xl p-1 bg-[#0a0a0a]",children:(0,t.jsx)(u,{markdown:g,onChange:v})})]}),(0,t.jsxs)("section",{className:"border-t border-gray-800 pt-8 flex flex-col gap-4",children:[(0,t.jsxs)("h2",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest flex items-center gap-2",children:[(0,t.jsx)(d,{className:"w-4 h-4"})," Revision History"]}),0===w.length?(0,t.jsx)("p",{className:"text-gray-700 text-sm italic",children:"No revisions yet."}):(0,t.jsx)("div",{className:"flex flex-col gap-3",children:w.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center p-4 rounded-lg bg-[#111] border border-gray-800 hover:border-gray-600 transition-all group",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 overflow-hidden",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500 font-mono",children:e.archived_at?.toDate().toLocaleString()}),(0,t.jsx)("span",{className:"text-sm text-gray-300 truncate font-medium",children:e.snapshot_title})]}),(0,t.jsxs)("button",{onClick:()=>{confirm("Restore this version?")&&(y(e.snapshot_title),v(e.snapshot_content),window.scrollTo(0,0))},className:"opacity-0 group-hover:opacity-100 text-xs bg-gray-800 text-yellow-500 px-3 py-1.5 rounded-md hover:bg-yellow-900/30 transition-all flex items-center gap-1",children:[(0,t.jsx)(h,{className:"w-3 h-3"})," Restore"]})]},e.id))})]})]}):(0,t.jsx)("div",{className:"h-screen flex items-center justify-center",children:(0,t.jsx)(o.Loader2,{className:"animate-spin text-gray-600"})})}function m(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{}),children:(0,t.jsx)(p,{})})}e.s(["default",()=>m],95430)},88174,e=>{e.v(t=>Promise.all(["static/chunks/fac2aa90d5f39e2e.js","static/chunks/c0a0c0f35d0a8771.css"].map(t=>e.l(t))).then(()=>t(72113)))}]);