(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},18566,(e,t,a)=>{t.exports=e.r(76562)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},27516,78894,e=>{"use strict";var t=e.i(75254);let a=(0,t.default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>a],27516);let s=(0,t.default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["AlertTriangle",()=>s],78894)},28180,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);e.i(36180);var r=e.i(98925),l=e.i(59141);e.i(51718);var i=e.i(18357),n=e.i(71689),o=e.i(56909),c=e.i(31278),d=e.i(27516),h=e.i(75254);let x=(0,h.default)("rotate-ccw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),m=(0,h.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var u=e.i(78894),p=e.i(22016);let g=(0,e.i(70703).default)(()=>e.A(88174),{loadableGenerated:{modules:[72113]},ssr:!1});function y(){let e=(0,s.useRouter)(),h=(0,s.useSearchParams)().get("id"),[y,f]=(0,a.useState)(null),[b,v]=(0,a.useState)(!0),[w,j]=(0,a.useState)(""),[N,k]=(0,a.useState)(""),[_,S]=(0,a.useState)(null),[M,A]=(0,a.useState)([]),[T,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=(0,i.onAuthStateChanged)(l.auth,async t=>{if(!t)return void e.push("/");if(f(t),h)try{let t=(0,r.doc)(l.db,"records",h),a=await (0,r.getDoc)(t);if(a.exists()){let e=a.data();j(e.title||""),k(e.content||""),S(e);let s=(0,r.query)((0,r.collection)(t,"revisions"),(0,r.orderBy)("archived_at","desc")),l=await (0,r.getDocs)(s);A(l.docs.map(e=>({id:e.id,...e.data()})))}else alert("기록을 찾을 수 없습니다."),e.push("/")}catch(e){console.error(e)}finally{v(!1)}});return()=>t()},[h,e]);let L=async()=>{if(w.trim()&&N.trim()&&h&&y){C(!0);try{let t=(0,r.doc)(l.db,"records",h);_&&await (0,r.addDoc)((0,r.collection)(t,"revisions"),{snapshot_title:_.title,snapshot_content:_.content,archived_at:(0,r.serverTimestamp)(),archived_by:y.uid,revision_note:"User Edit"}),await (0,r.updateDoc)(t,{title:w,content:N,updated_at:(0,r.serverTimestamp)(),last_modified_by:y.uid}),e.push(`/view?id=${h}`)}catch(e){console.error(e),alert("오류가 발생했습니다."),C(!1)}}},R=e=>e?new Date(e.toDate()).toLocaleString("ko-KR",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return b?(0,t.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center text-gray-500",children:(0,t.jsx)(c.Loader2,{className:"animate-spin"})}):(0,t.jsxs)("main",{className:"min-h-screen bg-black text-gray-200 p-6 md:p-12 border-x border-gray-900/50 max-w-5xl mx-auto flex flex-col gap-16",children:[(0,t.jsxs)("section",{className:"space-y-8",children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center",children:[(0,t.jsxs)(p.default,{href:`/view?id=${h}`,className:"text-gray-500 hover:text-white flex items-center gap-2",children:[(0,t.jsx)(n.ArrowLeft,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("span",{className:"text-xs font-mono text-yellow-600 bg-yellow-900/10 px-2 py-1 rounded border border-yellow-900/30 flex items-center gap-1",children:[(0,t.jsx)(u.AlertTriangle,{className:"w-3 h-3"})," Original will be archived"]}),(0,t.jsxs)("button",{onClick:L,disabled:T,className:"bg-yellow-600 text-white px-6 py-2 rounded font-bold hover:bg-yellow-700 disabled:opacity-50 flex items-center gap-2 shadow-lg shadow-yellow-900/20 transition-all",children:[T?(0,t.jsx)(c.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(o.Save,{className:"w-4 h-4"}),"Update Revision"]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("input",{type:"text",className:"w-full bg-transparent text-4xl md:text-5xl font-bold text-white placeholder-gray-800 border-b border-gray-800 pb-4 focus:border-yellow-600 focus:outline-none transition-colors",value:w,onChange:e=>j(e.target.value)}),(0,t.jsx)("div",{className:"min-h-[60vh] border border-gray-800 rounded-lg bg-[#0a0a0a] focus-within:ring-1 focus-within:ring-yellow-900/50 transition-all p-1",children:(0,t.jsx)(g,{markdown:N,onChange:k})})]})]}),(0,t.jsxs)("aside",{className:"border-t border-gray-800 pt-10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 font-bold uppercase tracking-widest text-xs mb-6 pl-1",children:[(0,t.jsx)(d.History,{className:"w-4 h-4"}),"Revision History"]}),0===M.length?(0,t.jsx)("div",{className:"text-gray-700 text-sm italic pl-1",children:"아직 수정 이력이 없습니다."}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(e=>(0,t.jsxs)("div",{className:"group p-5 rounded-lg bg-[#111] border border-gray-800 hover:border-gray-600 hover:bg-[#161616] transition-all flex flex-col justify-between min-h-[140px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,t.jsxs)("div",{className:"text-xs text-gray-500 font-mono flex items-center gap-1",children:[(0,t.jsx)(m,{className:"w-3 h-3"})," ",R(e.archived_at)]})}),(0,t.jsx)("h4",{className:"text-base font-bold text-gray-300 truncate mb-1",children:e.snapshot_title}),(0,t.jsx)("p",{className:"text-xs text-gray-600 line-clamp-2 leading-relaxed",children:e.snapshot_content})]}),(0,t.jsx)("div",{className:"mt-4 pt-3 border-t border-gray-800/50 flex justify-end",children:(0,t.jsxs)("button",{onClick:()=>{confirm(`[${R(e.archived_at)}] 버전으로 내용을 되돌리시겠습니까?`)&&(j(e.snapshot_title),k(e.snapshot_content),window.scrollTo({top:0,behavior:"smooth"}))},className:"text-xs bg-gray-800 hover:bg-yellow-900 text-gray-400 hover:text-yellow-500 px-3 py-1.5 rounded flex items-center gap-1.5 transition-colors",children:[(0,t.jsx)(x,{className:"w-3 h-3"})," Restore this version"]})})]},e.id))})]})]})}function f(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center text-gray-500",children:"Loading editor..."}),children:(0,t.jsx)(y,{})})}e.s(["default",()=>f],28180)},88174,e=>{e.v(t=>Promise.all(["static/chunks/fac2aa90d5f39e2e.js","static/chunks/c0a0c0f35d0a8771.css"].map(t=>e.l(t))).then(()=>t(72113)))}]);