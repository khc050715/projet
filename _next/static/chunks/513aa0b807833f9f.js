(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,33525,(e,t,a)=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0}),Object.defineProperty(a,"warnOnce",{enumerable:!0,get:function(){return s}});let s=e=>{}},56909,e=>{"use strict";let t=(0,e.i(75254).default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);e.s(["Save",()=>t],56909)},18566,(e,t,a)=>{t.exports=e.r(76562)},71689,e=>{"use strict";let t=(0,e.i(75254).default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],71689)},27516,e=>{"use strict";let t=(0,e.i(75254).default)("history",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],27516)},95430,e=>{"use strict";var t=e.i(18050),a=e.i(71645),s=e.i(18566);e.i(36180);var r=e.i(98925),i=e.i(59141);e.i(51718);var l=e.i(18357),n=e.i(71689),c=e.i(56909),o=e.i(31278),d=e.i(27516);let h=(0,e.i(75254).default)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);var u=e.i(22016);let x=(0,e.i(70703).default)(()=>e.A(88174),{loadableGenerated:{modules:[72113]},ssr:!1});function p(){let e=(0,s.useRouter)(),p=(0,s.useSearchParams)().get("id"),[m,f]=(0,a.useState)(null),[y,b]=(0,a.useState)(!0),[v,g]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[N,k]=(0,a.useState)(null),[_,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=(0,l.onAuthStateChanged)(i.auth,async t=>{if(!t)return void e.push("/");if(f(t),!p){alert("잘못된 접근입니다."),e.push("/");return}try{let t=(0,r.doc)(i.db,"records",p),a=await (0,r.getDoc)(t);if(a.exists()){let e=a.data();g(e.title||""),w(e.content||""),k(e)}else alert("기록을 찾을 수 없습니다."),e.push("/")}catch(e){console.error(e)}finally{b(!1)}});return()=>t()},[p,e]);let M=async()=>{if(v.trim()&&j.trim()&&p&&m){if(N.content===j&&N.title===v)return void alert("변경 사항이 없습니다.");S(!0);try{let t=(0,r.doc)(i.db,"records",p);N&&await (0,r.addDoc)((0,r.collection)(t,"revisions"),{snapshot_title:N.title,snapshot_content:N.content,snapshot_created_at:N.created_at,archived_at:(0,r.serverTimestamp)(),archived_by:m.uid,revision_note:"User Edit"}),await (0,r.updateDoc)(t,{title:v,content:j,updated_at:(0,r.serverTimestamp)(),last_modified_by:m.uid,revision_count:(N.revision_count||0)+1}),e.push("/")}catch(e){console.error("Revision failed:",e),alert("저장 중 오류가 발생했습니다."),S(!1)}}};return y?(0,t.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-black text-gray-500",children:(0,t.jsx)(o.Loader2,{className:"animate-spin"})}):(0,t.jsxs)("main",{className:"min-h-screen bg-black text-gray-200 p-6 md:p-12 max-w-4xl mx-auto border-x border-gray-900",children:[(0,t.jsxs)("nav",{className:"flex justify-between items-center mb-10",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)(u.default,{href:"/",className:"text-gray-500 hover:text-white flex items-center gap-2 transition-colors",children:[(0,t.jsx)(n.ArrowLeft,{className:"w-4 h-4"})," Cancel"]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1 rounded bg-yellow-900/20 border border-yellow-800/50 text-yellow-600 text-xs font-mono",children:[(0,t.jsx)(d.History,{className:"w-3 h-3"}),(0,t.jsx)("span",{children:"Revision Mode"})]})]}),(0,t.jsxs)("button",{onClick:M,disabled:_,className:"bg-yellow-600 text-white px-6 py-2 rounded font-bold hover:bg-yellow-700 disabled:opacity-50 flex items-center gap-2 transition-all shadow-[0_0_15px_rgba(202,138,4,0.3)]",children:[_?(0,t.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,t.jsx)(c.Save,{className:"w-4 h-4"}),_?"Archiving...":"Update Revision"]})]}),(0,t.jsxs)("div",{className:"space-y-8 animate-in fade-in duration-500",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest",children:"Title of Existence"}),(0,t.jsx)("input",{type:"text",className:"w-full bg-transparent text-4xl font-bold text-white placeholder-gray-800 border-b border-gray-800 pb-4 focus:border-yellow-600 focus:outline-none transition-colors",value:v,onChange:e=>g(e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("label",{className:"flex justify-between text-xs font-bold text-gray-600 uppercase tracking-widest",children:[(0,t.jsx)("span",{children:"Content Logic"}),(0,t.jsxs)("span",{className:"text-yellow-700 flex items-center gap-1",children:[(0,t.jsx)(h,{className:"w-3 h-3"})," Original will be archived"]})]}),(0,t.jsx)("div",{className:"min-h-[60vh] border border-gray-800 rounded-lg bg-[#0a0a0a] p-1 focus-within:ring-1 focus-within:ring-yellow-900 transition-all",children:(0,t.jsx)(x,{markdown:j,onChange:w})})]})]})]})}function m(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{className:"min-h-screen bg-black flex items-center justify-center text-gray-500",children:"Loading editor..."}),children:(0,t.jsx)(p,{})})}e.s(["default",()=>m],95430)},88174,e=>{e.v(t=>Promise.all(["static/chunks/fac2aa90d5f39e2e.js","static/chunks/c0a0c0f35d0a8771.css"].map(t=>e.l(t))).then(()=>t(72113)))}]);